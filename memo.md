https://github.com/battlelinegames/ArtOfWasm

# 二章
---
命名規則がよくわからない
- js にあわせたほうが良い気がする
- 書籍の中でもスネークケースか、キャメルケースか統一されてない

---
- helloworld.js の `({ helloworld: hello_world } = obj.instance.exports);`って書き方初めて見た
- ↑みたいな珍しい？高度な？書き方するくせに、`const`でいいところを`let`にしてたりする

---
- stack はおもったよりすんなりと理解できた
  - S式の展開も難しいとは感じなかった
  - まえにちょっとだけrevの勉強したときの記憶が残ってるせいかも
---

`local.set $sum`のときに、値をポップしてどこに格納しているのか気になった

- そこはwasm使う側の人は気にしなくていい部分？
- まえに出てきてた線形メモリってところではないと思う
  - まえに線形メモリを使ったときはもっと複雑な手続きが必要だった

---
`global.get`と`local.get`の違いがよくわかってない
どちらもスタック上に値を重ねるのでは？
js からも見えるのが global ということ？
ちがった、global, local というのは、変数についての属性で、グローバルなスタックとローカルなスタックがあるとかの話ではなかった

---
```wat
(global $start_string (import "env" "start_string") i32)
(global $string_len i32 (i32.const 12))
```
pdf p.40 の以下のコードもよくわからない
``````
global 変数名 値 型
global 変数名 型 値
``````

型と値の順番が違う？

---
> Memoryオブジェクトを 1 ページのサイズで初期化するために、コンストラクタの initial パラメータに 1 を渡しています。この方法で 2 ギガバイトまで確保できますが、この値を大きくしすぎると、Web ブラウザがその要求を満たすような連続メモリを見つけられない場合にエラーになることがあります　pdf p.41

この 2 GB までというのは、仕様で決められている部分？
メモリが連続していないといけない、というのは js で全然意識しない部分だから、低レイヤやってるという感じがする。
 
---
> 実際には、WAT の loop 式はひとりでにループしたりしません。loop 式の先頭に戻るには、ループの中に分岐文が含まれている必要があります。
> pdf p.57

分岐文が含まれている必要がある→br文が含まれている必要がある、じゃない？
それとも、br文のことを分岐文と呼んでる？と思ったら、そのとおりだった
> br 文（➋）はコード内の別の場所にジャンプすることをプログラムに命令する分岐文です
> pdf p.56

---
> Web ブラウザで実行するための WAT を記述するときには、無限ループは絶対に使わないでください。WebAssembly は Web ブラウザのレンダリングを行わないため、Web ブラウザに制御を戻す必要があります。WebAssembly が制御を戻さない場合、Web ブラウザは応答しなくなります。
> pdf p.58

wasm の処理もレンダリングをブロッキングするらしい。

---
`loop.wat`を眺めるかんじ、関数シグネチャでresultの型を指定すると、その型の分のデータをスタックからポップするっぽい。

---

block に br するとそのブロックの最後に飛ばされるというのは、大分慣れが必要そう。loop とは、そのブロックの先頭に戻るっていう考え方も、あんまりしっくりこなかった（考えればわかるけど）
他のアセンブリとかも、こういう感じでループを実装してるんだろうか？

---
br_table めっちゃ読みづらそう…
---
